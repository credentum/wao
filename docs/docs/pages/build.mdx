# The HyperBEAM Book

**From Zero to Building Custom Devices**

This book teaches you to build custom HyperBEAM devices. You'll start by learning Erlang, then progressively work through the codebase from low-level primitives to high-level devices. By the end, you'll understand every module and be ready to create your own.

:::warning
This book is in early development. Content may be incomplete or change without notice.
:::

:::note[About This Book]
Written for [HyperBEAM v0.9-milestone-3-beta-3](https://github.com/permaweb/HyperBEAM/releases/tag/v0.9-milestone-3-beta-3). Every chapter has a hands-on tutorial, and each module links to its full API reference.
:::

---

## Chapter 1: Setup

Get HyperBEAM running on your machine.

→ [Setup](/build/setup)

---

## Chapter 2: Erlang

HyperBEAM is written in Erlang. You cannot read the code without learning the language first.

→ [Erlang Crash Course](/build/erlang)

---

## Chapter 3: Project Structure

Before reading modules, understand how the codebase is organized.

→ [Project Structure](/build/structure)

---

## Chapter 4: Arweave Utils

Arweave blockchain primitives. HyperBEAM stores everything on Arweave—these modules are the foundation.

:::note[Coming Soon]
*Arweave Utils Tutorial*
:::

| Module | Description |
|--------|-------------|
| [rsa_pss](/src/rsa_pss) | RSA-PSS signature algorithm per RFC 3447, used by ar_wallet for all cryptographic operations |
| [ar_wallet](/src/ar_wallet) | Generates RSA-4096 keypairs, loads JWK keyfiles, signs data, verifies signatures, derives addresses |
| [ar_deep_hash](/src/ar_deep_hash) | Computes Arweave's recursive SHA-384 hash for transaction and data item ID generation |
| [ar_bundles](/src/ar_bundles) | Creates, signs, serializes, and deserializes ANS-104 data items and bundles |
| [ar_tx](/src/ar_tx) | Handles Layer 1 Arweave transactions including creation, signing, and serialization |
| [ar_timestamp](/src/ar_timestamp) | Fetches current block height and timestamp from Arweave network for time synchronization |
| [ar_rate_limiter](/src/ar_rate_limiter) | Token bucket rate limiter to prevent overwhelming Arweave gateways with requests |

---

## Chapter 5: HyperBEAM Core

Core HyperBEAM infrastructure.

:::note[Coming Soon]
*HyperBEAM Core Tutorial*
:::

---

### Utilities

Pure helper functions used throughout the codebase.

:::note[Coming Soon]
*Utilities Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_util](/src/hb_util) | Base64url encoding, unique ID generation, type coercion, and debug printing utilities |
| [hb_json](/src/hb_json) | JSON encoding and decoding wrapper supporting maps, lists, binaries, and primitives |
| [hb_escape](/src/hb_escape) | URI percent-encoding, path segment escaping, and safe string handling |
| [hb_structured_fields](/src/hb_structured_fields) | RFC 9651 HTTP Structured Fields parser for dictionaries, lists, and typed values |
| [hb_keccak](/src/hb_keccak) | Keccak-256 hashing via NIF, also derives Ethereum addresses from public keys |
| [hb_crypto](/src/hb_crypto) | Multi-algorithm signing helpers for RSA, ECDSA, Ed25519 with format conversion |

---

### Configuration

How HyperBEAM settings flow from defaults through node config to per-message overrides.

:::note[Coming Soon]
*Configuration Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_opts](/src/hb_opts) | Hierarchical configuration resolving options from message to node config to defaults |
| [hb_private](/src/hb_private) | Manages private keys and signing context, keeps secrets out of cached data |
| [hb_features](/src/hb_features) | Feature flag system for enabling/disabling functionality and gradual rollouts |
| [hb_path](/src/hb_path) | Parses paths into segments, matches patterns with wildcards, handles templates |

---

### Data Structures

Messages are maps. These modules define how they're created, signed, linked, and transformed.

:::note[Coming Soon]
*Data Structures Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_maps](/src/hb_maps) | Enhanced map operations with automatic link resolution and nested path traversal |
| [hb_message](/src/hb_message) | Creates messages, computes IDs, signs with attestations, verifies signatures |
| [hb_link](/src/hb_link) | Content-addressed references that resolve through cache with hashpath computation |
| [hb_singleton](/src/hb_singleton) | Converts between flat path-based keys and nested hierarchical message formats |
| [hb_format](/src/hb_format) | Detects message format (flat, nested, structured) and selects appropriate codec |

---

### Storage

Persistent data storage with pluggable backends.

:::note[Coming Soon]
*Storage Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_store](/src/hb_store) | Abstract storage interface defining read, write, list, delete operations |
| [hb_store_opts](/src/hb_store_opts) | Parses store configuration and creates store instances with fallback chains |
| [hb_store_fs](/src/hb_store_fs) | Filesystem storage backend that stores data as files in directories |
| [hb_store_lmdb](/src/hb_store_lmdb) | LMDB backend via NIF—fast, reliable, default storage with concurrent readers |
| [hb_store_rocksdb](/src/hb_store_rocksdb) | RocksDB LSM-tree backend via NIF for write-heavy workloads |
| [hb_store_lru](/src/hb_store_lru) | Wraps any store with in-memory LRU cache for improved read performance |
| [hb_volume](/src/hb_volume) | Manages storage partitions, handles mounting/unmounting and data routing |

---

### Caching

Content-addressed caching layer on top of storage.

:::note[Coming Soon]
*Caching Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_cache](/src/hb_cache) | Stores messages by content hash, resolves links recursively, expands nested messages |
| [hb_cache_control](/src/hb_cache_control) | Parses HTTP Cache-Control headers and determines cacheability of responses |

---

### HTTP Client

Outbound HTTP requests to gateways and other nodes.

:::note[Coming Soon]
*HTTP Client Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_http_client](/src/hb_http_client) | HTTP client wrapper managing Gun connections with pooling and retries |
| [hb_http_client_sup](/src/hb_http_client_sup) | Supervisor for HTTP client connection pools handling lifecycle and restarts |
| [hb_http_multi](/src/hb_http_multi) | Sends parallel requests to multiple nodes and aggregates results |
| [hb_http](/src/hb_http) | Convenience GET/POST helpers with codec negotiation and response parsing |
| [hb_gateway_client](/src/hb_gateway_client) | Arweave gateway API client for fetching transactions, data, and blocks |
| [hb_client](/src/hb_client) | High-level Arweave client combining gateway operations for common tasks |
| [hb_router](/src/hb_router) | Selects which nodes to contact based on health checks and routing preferences |

---

### Remote Storage

Storage backends that fetch data over the network.

:::note[Coming Soon]
*Remote Storage Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_store_gateway](/src/hb_store_gateway) | Fetches data from Arweave gateway on cache miss, read-only remote storage |
| [hb_store_remote_node](/src/hb_store_remote_node) | Fetches data from other HyperBEAM nodes enabling distributed storage |

---

### Protocol

The heart of HyperBEAM. Every request flows through `hb_ao:resolve/3`.

:::note[Coming Soon]
*Protocol Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_ao](/src/hb_ao) | Core protocol implementing resolve/3 that routes every request to devices |
| [hb_ao_device](/src/hb_ao_device) | Loads device modules by name, caches them, dispatches calls to handlers |

---

### HTTP Server

Inbound HTTP handling.

:::note[Coming Soon]
*HTTP Server Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_http_server](/src/hb_http_server) | Cowboy handlers routing HTTP requests to hb_ao with codec negotiation |

---

### WASM

WebAssembly execution environment.

:::note[Coming Soon]
*WASM Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_beamr](/src/hb_beamr) | WASM runtime interface via WAMR, manages module loading and execution |
| [hb_beamr_io](/src/hb_beamr_io) | Provides I/O primitives to WASM modules including stdin/stdout and files |

---

### Application

OTP application structure and node lifecycle.

:::note[Coming Soon]
*Application Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_name](/src/hb_name) | Registers and looks up Erlang processes by name within the node |
| [hb_persistent](/src/hb_persistent) | Stores process state durably to survive restarts with consistency guarantees |
| [hb_sup](/src/hb_sup) | Main supervisor defining the supervision tree and restart strategies |
| [hb_app](/src/hb_app) | OTP application behavior with start/stop callbacks and initialization |
| [hb](/src/hb) | Top-level API for starting/stopping nodes and convenience functions |

---

### Monitoring

Logging, tracing, debugging, and metrics.

:::note[Coming Soon]
*Monitoring Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_event](/src/hb_event) | Defines ?event macro for structured logging with levels and context |
| [hb_logger](/src/hb_logger) | Formats log events and routes to console/file with rotation support |
| [hb_tracer](/src/hb_tracer) | Records message flow through devices with trace IDs and timing data |
| [hb_debugger](/src/hb_debugger) | Interactive step debugger for device execution with state inspection |
| [hb_cache_render](/src/hb_cache_render) | Generates DOT/GraphViz graphs showing cache contents and relationships |
| [hb_metrics_collector](/src/hb_metrics_collector) | Collects and exposes Prometheus metrics for request counts and latencies |
| [hb_process_monitor](/src/hb_process_monitor) | Monitors Erlang process health, detects failures, reports status |

---

### Testing

Test utilities and conformance tests.

:::note[Coming Soon]
*Testing Tutorial*
:::

| Module | Description |
|--------|-------------|
| [hb_test_utils](/src/hb_test_utils) | Common test fixtures, assertion helpers, and mock setup utilities |
| [hb_ao_test_vectors](/src/hb_ao_test_vectors) | Protocol conformance test vectors ensuring hb_ao compatibility |
| [hb_message_test_vectors](/src/hb_message_test_vectors) | Test vectors for message creation, signing, and ID computation |
| [hb_http_benchmark_tests](/src/hb_http_benchmark_tests) | Performance benchmarks measuring throughput and latency distributions |
| [hb_examples](/src/hb_examples) | Usage examples demonstrating common patterns and best practices |

---

## Chapter 6: Preloaded Devices

Pluggable handlers that extend HyperBEAM. Each device handles specific message keys.

:::note[Coming Soon]
*Preloaded Devices Tutorial*
:::

---

### Codecs

Transform data between formats. Every message passes through at least one codec.

:::note[Coming Soon]
*Codecs Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_codec_httpsig](/src/dev_codec_httpsig) | HTTP Message Signatures (RFC-9421) for signing and verifying with Arweave keys |
| [dev_codec_httpsig_conv](/src/dev_codec_httpsig_conv) | Converts between HyperBEAM internal format and HTTP signature wire format |
| [dev_codec_httpsig_keyid](/src/dev_codec_httpsig_keyid) | Extracts key IDs from signatures and resolves them to public keys |
| [dev_codec_httpsig_siginfo](/src/dev_codec_httpsig_siginfo) | Extracts and validates signature parameters like algorithm and timestamps |
| [dev_codec_httpsig_proxy](/src/dev_codec_httpsig_proxy) | Forwards signed messages between nodes preserving signature validity |
| [dev_codec_flat](/src/dev_codec_flat) | Simplest codec representing messages as path-based key-value pairs |
| [dev_codec_structured](/src/dev_codec_structured) | Rich typed messages with explicit type annotations preserved through serialization |
| [dev_codec_json](/src/dev_codec_json) | Encodes messages as JSON with type mapping between Erlang and JSON |
| [dev_codec_ans104](/src/dev_codec_ans104) | Encodes and decodes messages as Arweave ANS-104 data items |
| [dev_codec_ans104_from](/src/dev_codec_ans104_from) | Parses binary ANS-104 data into message maps with all fields |
| [dev_codec_ans104_to](/src/dev_codec_ans104_to) | Converts message maps to binary ANS-104 format with signing |
| [dev_codec_cookie](/src/dev_codec_cookie) | Parses Cookie headers and serializes Set-Cookie for browser clients |
| [dev_codec_cookie_auth](/src/dev_codec_cookie_auth) | Issues and validates session cookies integrated with httpsig verification |
| [dev_codec_http_auth](/src/dev_codec_http_auth) | Parses HTTP Authorization headers including Bearer and Basic schemes |

---

### Message Operations

Basic message manipulation—get, set, transform, compose.

:::note[Coming Soon]
*Message Operations Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_message](/src/dev_message) | Default device handling get, set, keys, remove, id, type operations |
| [dev_stack](/src/dev_stack) | Composes multiple devices into a pipeline processing messages in order |
| [dev_multipass](/src/dev_multipass) | Runs messages through device pipeline multiple times until stable |
| [dev_apply](/src/dev_apply) | Resolves a path on a message then applies the result as a device |
| [dev_hook](/src/dev_hook) | Executes before/after handlers around device calls for cross-cutting concerns |
| [dev_dedup](/src/dev_dedup) | Tracks seen message IDs and skips duplicates for exactly-once processing |
| [dev_patch](/src/dev_patch) | Merges patch data into messages with deep merge and conditional operations |

---

### Infrastructure

Routing, naming, and node configuration.

:::note[Coming Soon]
*Infrastructure Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_router](/src/dev_router) | Matches message paths against patterns and routes to device stacks |
| [dev_relay](/src/dev_relay) | Forwards messages to other HyperBEAM nodes with discovery and retry |
| [dev_name](/src/dev_name) | Resolves human-readable names to IDs via configured resolver chain |
| [dev_local_name](/src/dev_local_name) | Maps names to IDs within a single node using in-memory storage |
| [dev_meta](/src/dev_meta) | Returns node metadata including version, capabilities, and public key |
| [dev_manifest](/src/dev_manifest) | Defines process configuration—device stack, scheduler, compute limits |

---

### Process Management

Stateful computation units and their lifecycle.

:::note[Coming Soon]
*Process Management Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_process](/src/dev_process) | Creates processes, loads state, executes messages, persists state changes |
| [dev_process_cache](/src/dev_process_cache) | Caches computed process states for fast replay with invalidation |
| [dev_process_worker](/src/dev_process_worker) | Manages worker pools for parallel process execution and distribution |
| [dev_node_process](/src/dev_node_process) | Singleton processes running once per node with persistent state |

---

### Scheduler

Deterministic message ordering and execution scheduling.

:::note[Coming Soon]
*Scheduler Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_scheduler](/src/dev_scheduler) | Assigns slots to messages maintaining deterministic ordering |
| [dev_scheduler_cache](/src/dev_scheduler_cache) | Caches scheduler assignments for fast lookup with consistency |
| [dev_scheduler_formats](/src/dev_scheduler_formats) | Handles different format versions for scheduler messages |
| [dev_scheduler_registry](/src/dev_scheduler_registry) | Registers processes with schedulers and handles discovery |
| [dev_scheduler_server](/src/dev_scheduler_server) | Long-running process handling scheduling requests and state |
| [dev_push](/src/dev_push) | Sends messages to processes without waiting, fire-and-forget |
| [dev_cron](/src/dev_cron) | Triggers messages on time schedules with cron expressions and intervals |

---

### Arweave

Direct blockchain interaction.

:::note[Coming Soon]
*Arweave Devices Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_arweave](/src/dev_arweave) | Gateway device for fetching data from and posting transactions to Arweave |
| [dev_arweave_block_cache](/src/dev_arweave_block_cache) | Caches Arweave blocks locally reducing gateway requests |
| [dev_poda](/src/dev_poda) | Generates and verifies cryptographic proofs that data exists on Arweave |

---

### Security

Authentication, secrets, and trusted execution.

:::note[Coming Soon]
*Security Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_secret](/src/dev_secret) | Stores and retrieves secrets securely with encryption and access control |
| [dev_auth_hook](/src/dev_auth_hook) | Verifies caller identity before processing and rejects unauthorized requests |
| [dev_snp](/src/dev_snp) | AMD SEV-SNP attestation for hardware-backed Trusted Execution Environment |
| [dev_snp_nif](/src/dev_snp_nif) | Native C interface for low-level AMD SEV-SNP operations |
| [dev_green_zone](/src/dev_green_zone) | Defines security boundaries for sensitive operations requiring TEE |

---

### Query & Replication

Finding and syncing data across nodes and Arweave.

:::note[Coming Soon]
*Query & Replication Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_query](/src/dev_query) | Searches messages by criteria with filtering, pagination, and sorting |
| [dev_query_arweave](/src/dev_query_arweave) | Queries Arweave gateway for transactions and blocks via GraphQL |
| [dev_query_graphql](/src/dev_query_graphql) | Executes GraphQL queries against configured endpoints |
| [dev_copycat](/src/dev_copycat) | Copies data between stores/nodes with sync and conflict resolution |
| [dev_copycat_arweave](/src/dev_copycat_arweave) | Replicates data from Arweave to local storage for availability |
| [dev_copycat_graphql](/src/dev_copycat_graphql) | Uses GraphQL queries to discover and replicate data |
| [dev_lookup](/src/dev_lookup) | Finds messages by various criteria including ID, tags, and sender |
| [dev_cache](/src/dev_cache) | Explicit cache control—read, write, invalidate cache directly |

---

### Runtimes

Code execution environments—WASM, Lua, delegated compute.

:::note[Coming Soon]
*Runtimes Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_json_iface](/src/dev_json_iface) | JSON-based interface simplifying WASM module integration |
| [dev_wasm](/src/dev_wasm) | Loads and runs WebAssembly modules managing memory and imports |
| [dev_wasi](/src/dev_wasi) | WebAssembly System Interface providing filesystem and I/O to WASM |
| [dev_delegated_compute](/src/dev_delegated_compute) | Offloads computation to other nodes with result verification |
| [dev_genesis_wasm](/src/dev_genesis_wasm) | Configures initial WASM module as default execution environment |
| [dev_lua](/src/dev_lua) | Embeds Lua 5.3 interpreter for lightweight scripting within HyperBEAM |
| [dev_lua_lib](/src/dev_lua_lib) | HyperBEAM API bindings exposed to Lua scripts |

---

### Payment

Compute metering and billing.

:::note[Coming Soon]
*Payment Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_cu](/src/dev_cu) | Measures computation cost tracking CPU time, memory, and I/O |
| [dev_faff](/src/dev_faff) | Defines fee structures, calculates costs, validates payment policies |
| [dev_simple_pay](/src/dev_simple_pay) | Basic pay-per-request processor checking balance and deducting fees |
| [dev_p4](/src/dev_p4) | Advanced payment protocol with channels, streaming, and settlement |

---

### Utilities

Development and debugging tools.

:::note[Coming Soon]
*Device Utilities Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_trie](/src/dev_trie) | Prefix tree implementation for efficient key lookup and iteration |
| [dev_volume](/src/dev_volume) | Volume device for mounting, unmounting, and listing storage volumes |
| [dev_profile](/src/dev_profile) | Records execution timing and memory allocation for profiling |
| [dev_hyperbuddy](/src/dev_hyperbuddy) | Web-based interactive debugging UI for message and cache inspection |
| [dev_cacheviz](/src/dev_cacheviz) | Generates visual representation of cache contents for debugging |
| [dev_whois](/src/dev_whois) | Looks up node information by address returning capabilities and endpoints |
| [dev_monitor](/src/dev_monitor) | Tracks system health—memory, disk, network—with alerting |
| [dev_test](/src/dev_test) | Test device with configurable responses and error injection |

---

### Test Vectors

Reference test cases for conformance.

:::note[Coming Soon]
*Test Vectors Tutorial*
:::

| Module | Description |
|--------|-------------|
| [dev_codec_cookie_test_vectors](/src/dev_codec_cookie_test_vectors) | Test cases for cookie parsing and serialization conformance |
| [dev_query_test_vectors](/src/dev_query_test_vectors) | Test cases for query device behavior conformance |
| [dev_lua_test](/src/dev_lua_test) | Integration test cases for Lua runtime execution |
| [dev_lua_test_ledgers](/src/dev_lua_test_ledgers) | Test cases for Lua-based ledger operations |

---

## Resources

- [Official Documentation](https://hyperbeam.ar.io/)
- [GitHub Repository](https://github.com/permaweb/HyperBEAM)
- [Decoding HyperBEAM from Scratch](https://docs.wao.eco/hyperbeam/decoding-from-scratch)